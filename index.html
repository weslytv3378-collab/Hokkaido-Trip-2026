<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>åŒ—æµ·é“ä¹‹æ—… 1/9-1/15</title>
    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0066cc">
    
    <!-- 1. æ ¸å¿ƒç¨‹å¼åº« -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 2. æ¨£å¼åº« -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Markdown è§£æå™¨ (è®“ AI å›è¦†æ›´å¥½çœ‹) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- 3. æ‰‹æ©Ÿæ‹–æ›³ Polyfill -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/default.css">
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/scroll-behaviour.min.js"></script>

    <script>
        // åˆå§‹åŒ–æ‰‹æ©Ÿæ‹–æ›³åŠŸèƒ½
        var MobileDragDrop = MobileDragDrop || {};
        MobileDragDrop.polyfill({
            dragImageTranslateOverride: MobileDragDrop.scrollBehaviourDragImageTranslateOverride
        });
        
        // ä¿®æ­£ï¼šå·²ç§»é™¤åŸæœ¬æœƒå°è‡´ç„¡æ³•æ»‘å‹•çš„ touchmove ç›£è½å™¨
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f7f3e8; 
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* é˜²æ­¢æ•´é ä¸‹æ‹‰é‡æ–°æ•´ç†ï¼Œä½†å…è¨±å…§éƒ¨æ²å‹• */
            user-select: none;
        }
        
        /* æ¢å¾©è¼¸å…¥æ¡†çš„æ–‡å­—é¸å–åŠŸèƒ½ */
        input, textarea {
            user-select: text;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* AI å°è©±æ¡†å‹•ç•« */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        }

        /* æ‹–æ›³æ™‚çš„æ¨£å¼ */
        .dragging {
            opacity: 0.5;
            background-color: #f0fdf4;
            border: 2px dashed #556b2f;
            transform: scale(0.98);
        }
        
        /* ä¿®æ­£æ‰‹æ©Ÿæ‹–æ›³æ™‚çš„é è¦½åœ– */
        .dnd-drag-image-preview {
            background-color: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            opacity: 0.9;
            width: 300px;
            font-weight: bold;
            color: #556b2f;
            border: 2px solid #556b2f;
        }

        /* Markdown æ¨£å¼å¾®èª¿ */
        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose strong { color: #556b2f; font-weight: 800; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const apiKey = "AIzaSyAz7ClMSh9BmSGSTwfmIp2e4dcoYomm0CM"; // Gemini API Key will be injected by the environment

        // --- Gemini API å‘¼å«å‡½å¼ ---
        const callGeminiAPI = async (messages) => {
            if (!apiKey) return "éŒ¯èª¤ï¼šæœªè¨­å®š API Key";

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            // è½‰æ›å°è©±ç´€éŒ„æ ¼å¼
            const contents = messages.map(msg => ({
                role: msg.role === 'user' ? 'user' : 'model',
                parts: [{ text: msg.content }]
            }));

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "æŠ±æ­‰ï¼ŒAI å°éŠç›®å‰æœ‰é»å¿™ç¢Œï¼Œè«‹ç¨å¾Œå†è©¦ã€‚(é€£ç·šéŒ¯èª¤)";
            }
        };

        // --- å„ªåŒ–å¾Œçš„åœ–ç¤ºå…ƒä»¶ (æ•ˆèƒ½ä¿®æ­£) ---
        const Icon = ({ name, size = 18, className = "" }) => {
            const iconRef = useRef(null);

            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    window.lucide.createIcons({
                        root: iconRef.current,
                        nameAttr: 'data-lucide',
                        attrs: { class: className }
                    });
                }
            }, [name, className]);

            return <span ref={iconRef} style={{ display: 'inline-flex', verticalAlign: 'middle' }}>
                <i data-lucide={name} style={{ width: size, height: size }}></i>
            </span>;
        };

        // --- AI èŠå¤©å®¤å…ƒä»¶ ---
        const AIChatWidget = ({ isOpen, onClose, currentDayData }) => {
            const [messages, setMessages] = useState([
                { role: 'model', content: `å—¨ï¼æˆ‘æ˜¯ä½ çš„åŒ—æµ·é“ AI å°éŠ âœ¨\n\næ‚¨æ­£åœ¨æŸ¥çœ‹ **${currentDayData.date} (${currentDayData.weekday})** çš„è¡Œç¨‹ã€‚\næˆ‘æœ‰çœ‹éè¡Œç¨‹äº†ï¼Œæƒ³å•ä»€éº¼éƒ½å¯ä»¥å–”ï¼` }
            ]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                if (isOpen) scrollToBottom();
            }, [messages, isOpen]);
            
            // ç•¶å¤©æ›äº†ï¼Œé‡ç½®æ­¡è¿è¨Šæ¯
            useEffect(() => {
                setMessages([
                     { role: 'model', content: `å—¨ï¼æˆ‘æ˜¯ä½ çš„åŒ—æµ·é“ AI å°éŠ âœ¨\n\næ‚¨æ­£åœ¨æŸ¥çœ‹ **${currentDayData.date} (${currentDayData.weekday})** çš„è¡Œç¨‹ã€‚\nå¤©æ°£é å ±æ˜¯ ${currentDayData.temp} ${currentDayData.weather === 'snow' ? 'ä¸‹é›ª â„ï¸' : ''}ã€‚\næƒ³å•ä»€éº¼éƒ½å¯ä»¥å–”ï¼` }
                ]);
            }, [currentDayData.id]);

            const handleSend = async (text = inputValue) => {
                if (!text.trim()) return;
                
                const userMsg = { role: 'user', content: text };
                setMessages(prev => [...prev, userMsg]);
                setInputValue('');
                setIsLoading(true);
                
                const contextPrompt = `
                    [ç³»çµ±æŒ‡ç¤º: ä½ æ˜¯ä¸€ä½å°ˆæ¥­ã€ç†±æƒ…ä¸”å¹½é»˜çš„åŒ—æµ·é“æ—…éŠå°éŠã€‚]
                    [ç›®å‰ä½¿ç”¨è€…æ­£åœ¨æŸ¥çœ‹çš„è¡Œç¨‹å¦‚ä¸‹:]
                    æ—¥æœŸ: ${currentDayData.date} (${currentDayData.weekday})
                    å¤©æ°£: ${currentDayData.weather}, æ°£æº«: ${currentDayData.temp}
                    ä»Šæ—¥æ¨™é¡Œ: ${currentDayData.title}
                    è©³ç´°è¡Œç¨‹é …ç›®: ${JSON.stringify(currentDayData.items.map(i => `${i.time} ${i.title} (${i.location}) - ${i.note || ''} - ${i.guide || ''}`))}
                    
                    è«‹æ ¹æ“šä»¥ä¸Šè¡Œç¨‹è³‡è¨Šå›ç­”ä½¿ç”¨è€…çš„å•é¡Œã€‚å¦‚æœä½¿ç”¨è€…å•æ¨è–¦ï¼Œè«‹æ ¹æ“šè¡Œç¨‹åœ°é»æ¨è–¦é †è·¯çš„ã€‚
                    è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œèªæ°£è¼•é¬†æ´»æ½‘ï¼Œé©ç•¶ä½¿ç”¨ emojiã€‚
                    
                    ä½¿ç”¨è€…å•é¡Œ: ${text}
                `;

                const apiMessages = [
                    ...messages.slice(-4), 
                    { role: 'user', content: contextPrompt }
                ];

                const replyText = await callGeminiAPI(apiMessages);
                
                setMessages(prev => [...prev, { role: 'model', content: replyText }]);
                setIsLoading(false);
            };

            const quickActions = [
                { label: "âœ¨ åˆ†æä»Šæ—¥è¡Œç¨‹", prompt: "è«‹å¹«æˆ‘åˆ†æä»Šå¤©çš„è¡Œç¨‹å®‰æ’æ˜¯å¦é †æš¢ï¼Ÿæœ‰æ²’æœ‰ä»€éº¼æ™‚é–“å¤ªè¶•çš„åœ°æ–¹ï¼Ÿæˆ–æ˜¯å»ºè­°å¯ä»¥å¤šåŠ æ³¨æ„çš„å°æé†’ï¼Ÿ" },
                { label: "â„ï¸ ç©¿æ­å»ºè­°", prompt: "æ ¹æ“šä»Šå¤©çš„å¤©æ°£å’Œè¡Œç¨‹æ´»å‹•ï¼ˆä¾‹å¦‚å®¤å…§å®¤å¤–æ¯”ä¾‹ï¼‰ï¼Œå»ºè­°æˆ‘è©²æ€éº¼ç©¿è¡£æœï¼Ÿ" },
                { label: "ğŸœ é™„è¿‘éš±è—ç¾é£Ÿ", prompt: "è«‹æ ¹æ“šæˆ‘ä»Šå¤©è¡Œç¨‹ä¸­çš„åœ°é»ï¼Œæ¨è–¦ 2-3 å®¶é †è·¯ä¸”é«˜è©•åƒ¹çš„éš±è—ç‰ˆç¾é£Ÿï¼ˆåˆé¤æˆ–æ™šé¤ï¼‰ã€‚" },
                { label: "ğŸ å¿…è²·ä¼´æ‰‹ç¦®", prompt: "ä»Šå¤©çš„è¡Œç¨‹åœ°é»é™„è¿‘æœ‰ä»€éº¼ã€Œå¿…è²·ã€çš„é™å®šä¼´æ‰‹ç¦®å—ï¼Ÿ" },
            ];

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[60] flex items-end sm:items-center sm:justify-center pointer-events-none">
                    {/* èƒŒæ™¯é®ç½© */}
                    <div className="absolute inset-0 bg-black/30 backdrop-blur-sm pointer-events-auto" onClick={onClose} />
                    
                    {/* èŠå¤©è¦–çª— */}
                    <div className="bg-[#fdfbf7] w-full sm:w-[400px] h-[80vh] sm:h-[600px] rounded-t-[32px] sm:rounded-[32px] shadow-2xl flex flex-col pointer-events-auto animate-slide-up overflow-hidden relative">
                        {/* Header */}
                        <div className="bg-[#556b2f] text-white p-4 flex justify-between items-center shadow-md z-10">
                            <div className="flex items-center gap-2">
                                <div className="bg-white/20 p-2 rounded-full">
                                    <Icon name="sparkles" size={20} className="text-yellow-300" />
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg">AI è²¼èº«å°éŠ</h3>
                                    <p className="text-[10px] opacity-80">Powered by Gemini âœ¨</p>
                                </div>
                            </div>
                            <button onClick={onClose} className="p-2 hover:bg-white/20 rounded-full transition-colors">
                                <Icon name="x" size={24} />
                            </button>
                        </div>

                        {/* Messages Area */}
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-dots">
                            {messages.map((msg, idx) => (
                                <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[85%] p-4 rounded-2xl shadow-sm text-sm leading-relaxed ${
                                        msg.role === 'user' 
                                            ? 'bg-[#556b2f] text-white rounded-tr-none' 
                                            : 'bg-white text-gray-700 rounded-tl-none border border-gray-100'
                                    }`}>
                                        {msg.role === 'model' 
                                            ? <div className="prose prose-sm" dangerouslySetInnerHTML={{ __html: marked.parse(msg.content) }} />
                                            : msg.content
                                        }
                                    </div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="flex justify-start">
                                    <div className="bg-white p-4 rounded-2xl rounded-tl-none border border-gray-100 shadow-sm flex gap-2 items-center">
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0s'}} />
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}} />
                                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.4s'}} />
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Quick Actions (Horizontal Scroll) */}
                        <div className="bg-gray-50/50 p-2 border-t border-gray-100">
                             <div className="flex gap-2 overflow-x-auto no-scrollbar px-2 pb-2">
                                {quickActions.map((action, idx) => (
                                    <button 
                                        key={idx}
                                        onClick={() => handleSend(action.prompt)}
                                        disabled={isLoading}
                                        className="flex-shrink-0 bg-white border border-[#556b2f]/20 text-[#556b2f] px-3 py-1.5 rounded-full text-xs font-bold shadow-sm hover:bg-[#556b2f] hover:text-white transition-all whitespace-nowrap active:scale-95 disabled:opacity-50"
                                    >
                                        {action.label}
                                    </button>
                                ))}
                             </div>
                        </div>

                        {/* Input Area */}
                        <div className="p-4 bg-white border-t border-gray-100 pb-8 sm:pb-4">
                            <div className="flex gap-2 items-end">
                                <textarea 
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    placeholder="å•å•å°éŠ..."
                                    className="flex-1 bg-gray-100 rounded-2xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#556b2f] resize-none max-h-24"
                                    rows={1}
                                    onKeyDown={(e) => {
                                        if (e.key === 'Enter' && !e.shiftKey) {
                                            e.preventDefault();
                                            handleSend();
                                        }
                                    }}
                                />
                                <button 
                                    onClick={() => handleSend()}
                                    disabled={!inputValue.trim() || isLoading}
                                    className="bg-[#556b2f] text-white p-3 rounded-full shadow-lg shadow-[#556b2f]/30 hover:bg-[#445725] active:scale-90 transition-all disabled:opacity-50 disabled:shadow-none"
                                >
                                    <Icon name="send" size={20} />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- å®Œæ•´è¡Œç¨‹è³‡æ–™ ---
        const defaultItinerary = [
            {
                id: 'day1',
                date: '1/9',
                weekday: 'é€±äº”',
                title: 'å‡ºç™¼ï¼å‰å¾€åŒ—åœ‹æœ­å¹Œ',
                weather: 'snowflake',
                temp: '-2Â°C',
                items: [
                    { 
                        id: 'd1-0', time: '22:40', endTime: '23:40', type: 'transport', transportMode: 'å®¢é‹', title: 'æ¾å±±æ©Ÿå ´ â†’ æ¡ƒåœ’æ©Ÿå ´', location: 'æ¾å±±æ©Ÿå ´', note: 'æ­ä¹˜åœ‹å…‰1840å®¢é‹ (1/8 å‡ºç™¼)', 
                        guide: 'æ·±å¤œå‡ºç™¼è¦æ³¨æ„ä¿æš–ï¼Œè»Šä¸Šè£œçœ ä¸€ä¸‹ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼š(å‡ºç™¼å‰çœé»éŒ¢)\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šæ©Ÿå ´ä¾¿åˆ©å•†åº—å‚™é»é›¶é£Ÿ', 
                        expenses: [] 
                    },
                    { 
                        id: 'd1-1', time: '02:55', endTime: '06:25', type: 'transport', transportMode: 'é£›æ©Ÿ', title: 'æ¡ƒåœ’ â†’ åå¤å±‹ä¸­éƒ¨', location: 'æ¡ƒåœ’æ©Ÿå ´', note: 'æ¨‚æ¡ƒèˆªç©º', 
                        guide: 'ç´…çœ¼ç­æ©Ÿè¾›è‹¦äº†ï¼æ¨‚æ¡ƒæ©Ÿä¸Šä½å­è¼ƒå°ï¼Œå»ºè­°å¸¶å€‹é ¸æ•ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šå…ç¨…åº—é³³æ¢¨é…¥(é€æ—¥æœ¬å‹äºº)\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šæ©Ÿå ´å…ç¨…åº—', 
                        expenses: [] 
                    },
                    { 
                        id: 'd1-2', time: '06:25', endTime: '08:10', type: 'todo', title: 'å…¥å¢ƒã€è½‰æ©Ÿæ‰‹çºŒ', location: 'åå¤å±‹ä¸­éƒ¨æ©Ÿå ´', note: 'å…¥å¢ƒå®Œæˆã€å‡ºé—œã€å‰å¾€ANAæ«ƒå°è¾¦æ‰˜é‹è¡Œæ', 
                        guide: 'è½‰æ©Ÿæ™‚é–“é›–ç„¶å……è£•ï¼Œä½†å…¥å¢ƒå’Œé‡æ–°æ›è¡Œæé‚„æ˜¯è¦æŠ“ç·Šæ™‚é–“å–”ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šè¦é¤…(åå¤å±‹åç”¢)ã€å°å€‰ç´…è±†åå¸æŠ¹é†¬ã€æ‰‹ç¾½å…ˆå£å‘³é¤…ä¹¾\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šæ©Ÿå ´ 4F è—å¤©åŸ (Sky Town)', 
                        expenses: [] 
                    },
                    { 
                        id: 'd1-3', time: '08:40', endTime: '10:25', type: 'transport', transportMode: 'é£›æ©Ÿ', title: 'åå¤å±‹ä¸­éƒ¨ â†’ æ–°åƒæ­²', location: 'åå¤å±‹ä¸­éƒ¨æ©Ÿå ´', note: 'ANAèˆªç©º', 
                        guide: 'ANA åœ‹å…§ç·šèˆ’é©å¾ˆå¤šï¼Œå¯ä»¥ç¨å¾®æ”¾é¬†ï¼Œçœ‹çœ‹çª—å¤–çš„é›ªæ™¯ã€‚', 
                        expenses: [] 
                    },
                    { 
                        id: 'd1-4', time: '10:25', endTime: '11:20', type: 'todo', title: 'é ˜å–è¡Œæ & JR PASS', location: 'æ–°åƒæ­²æ©Ÿå ´', note: 'é ˜å–è¡Œæã€JR PASSåŠæŒ‡å®šå¸­åº§ä½ç¥¨', 
                        guide: 'æ–°åƒæ­²æ©Ÿå ´éå¸¸å¤§ä¸”ç†±é¬§ï¼é ˜å®Œ PASS åˆ¥å¿˜äº†ç¢ºèªæŒ‡å®šå¸­åº§ä½ç¥¨ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šKinotoya èµ·å¸å¡”ã€åŒ—è“æ¨“å¤¢ä¸æ€è­°æ³¡èŠ™ã€ç¾ç‘›é¸æœç‰ç±³éºµåŒ…\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå“†å•¦Aå¤¢ç©ºä¸­æ¨‚åœ’å•†åº— (3F)ã€Smile Road', 
                        expenses: [] 
                    },
                    { 
                        id: 'd1-5', time: '11:20', endTime: '11:57', type: 'transport', transportMode: 'JR', title: 'æ–°åƒæ­²æ©Ÿå ´ â†’ æœ­å¹Œ', location: 'æ–°åƒæ­²æ©Ÿå ´ç«™', note: 'JR å¿«é€Ÿ Airport', 
                        guide: 'å¿«é€Ÿ Airport è™Ÿå¤§ç´„ 40 åˆ†é˜å°±åˆ°å¸‚å€ï¼Œæ²¿é€”é¢¨æ™¯é–‹å§‹è®Šç™½å›‰ã€‚', 
                        expenses: [] 
                    },
                    { id: 'd1-6', time: '12:00', endTime: '', type: 'food', title: 'åˆé¤ï¼šæ¹¯å’–å“© å¥¥èŠå•†åº—', location: 'å¥¥èŠå•†åº— é§…å‰å‰µæˆå¯º', note: 'ã‚¹ãƒ¼ãƒ—ã‚«ãƒ¬ãƒ¼å¥¥èŠå•†åº—', guide: 'ã€å¿…åƒã€‘æ¹¯å’–å“©ååº—ï¼æ¿ƒéƒçš„è¦å‘³æ¹¯é ­æ˜¯æ‹›ç‰Œã€‚', expenses: [] },
                    { id: 'd1-7', time: '13:00', endTime: '', type: 'food', title: 'åˆé¤ï¼šç‡’è‚‰', location: 'ç„¼è‚‰å¾³å¯¿ ã—ã‚“ã‚‰äº­', note: 'ç„¼è‚‰å¾³å¯¿ ã—ã‚“ã‚‰äº­', guide: 'æ—¢ç„¶ä¾†äº†å°±ä¸è¦å®¢æ°£ï¼å“åšä¸€ä¸‹åŒ—æµ·é“ç•¶åœ°çš„ç‡’è‚‰ã€‚', expenses: [] },
                    { id: 'd1-8', time: '14:00', endTime: '', type: 'food', title: 'åˆé¤ï¼šæµ·é®®ä¸¼', location: 'æœ­å¹Œæµ·é®®ä¸¼å°‚é–€åº— ã™ã—ã©ã‚“ã¶ã‚Š', note: 'æœ­å¹Œæµ·é®®ä¸¼å°‚é–€åº— ã™ã—ã©ã‚“ã¶ã‚Š', guide: 'æˆ‘çŸ¥é“å¾ˆé£½ï¼Œä½†åŒ—æµ·é“çš„æµ·é®®æ€éº¼èƒ½éŒ¯éï¼Ÿ', expenses: [] },
                    { id: 'd1-9', time: '15:00', endTime: '15:30', type: 'transport', transportMode: 'åœ°éµ', title: 'å‰å¾€é£¯åº—æ”¾è¡Œæ', location: 'Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’', note: 'æ­ä¹˜åœ°éµå‰å¾€ç¬¬ä¸€å¤©é£¯åº—', guide: 'Vessel Inn çš„æ—©é¤éå¸¸æœ‰åï¼Œä»Šæ™šå¯ä»¥å¥½å¥½æœŸå¾…ï¼', expenses: [] },
                    { id: 'd1-10', time: '15:30', endTime: '16:00', type: 'transport', transportMode: 'åœ°éµ', title: 'ä¸­å³¶å…¬åœ’ â†’ åŒ—æµ·é“ç¥å®®', location: 'åœ“å±±å…¬åœ’ç«™', note: 'ä¸­å³¶å…¬åœ’â†’å¤§é€šâ†’åœ“å±±å…¬åœ’', guide: 'å‡ºç«™å¾Œè¦èµ°ä¸€æ®µè·¯ï¼Œç©¿è¶Šåœ“å±±å…¬åœ’çš„é›ªåœ°æ­¥é“éå¸¸ç¾ã€‚', expenses: [] },
                    { 
                        id: 'd1-11', time: '16:00', endTime: '17:00', type: 'sight', title: 'åŒ—æµ·é“ç¥å®®', location: 'åŒ—æµ·é“ç¥å®®', note: 'åƒæ‹œ', 
                        guide: 'ã€å¿…çœ‹ã€‘è¢«é›ªè¦†è“‹çš„ç¥å®®èŠåš´åˆæµªæ¼«ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šç¥å®®é™å®šå¾¡å®ˆ(Hello Kitty/æ‹‰æ‹‰ç†Š)ã€åˆ¤å®˜é¤…(å…­èŠ±äº­ç¥å®®èŒ¶å±‹ç¾çƒ¤)ã€ç¥å®®å¾¡æœ±å°\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå…­èŠ±äº­ ç¥å®®èŒ¶å±‹åº—', 
                        expenses: [] 
                    },
                    { id: 'd1-12', time: '17:00', endTime: '17:30', type: 'transport', transportMode: 'åœ°éµ', title: 'å‰å¾€è–„é‡', location: 'è–„é‡ç«™', note: 'åœ“å±±å…¬åœ’â†’å¤§é€šâ†’è–„é‡', guide: 'è–„é‡æ˜¯æœ­å¹Œæœ€ç†±é¬§çš„å¤œç”Ÿæ´»å€ï¼Œè‘—åçš„ NIKKA å¨å£«å¿Œå¤§å”æ‹›ç‰Œå°±åœ¨é€™ï¼', expenses: [] },
                    { id: 'd1-13', time: '18:00', endTime: '19:30', type: 'food', title: 'æ™šé¤: æ¶®æ¶®é‹', location: 'åŒ—æµ·é“ã—ã‚ƒã¶ã—ã‚ƒã¶ å¤§åœ°', note: 'åŒ—æµ·é“ã—ã‚ƒã¶ã—ã‚ƒã¶ å¤§åœ°', guide: 'å†·å†·çš„å¤©æ°£åƒæš–æš–çš„æ¶®æ¶®é‹æœ€æ£’äº†ã€‚', expenses: [] },
                    { id: 'd1-14', time: '19:30', endTime: '20:00', type: 'transport', transportMode: 'åœ°éµ', title: 'è–„é‡ â†’ æœ­å¹Œ', location: 'æœ­å¹Œè»Šç«™', note: 'åœ°éµ', guide: 'åƒé£½å¾Œç¨å¾®ç§»å‹•ä¸€ä¸‹ï¼Œæº–å‚™å»æœ­å¹Œè»Šç«™å¤§æ¡è³¼ã€‚', expenses: [] },
                    { 
                        id: 'd1-15', time: '20:00', endTime: '', type: 'sight', title: 'æœ­å¹Œè»Šç«™é€›è¡—', location: 'æœ­å¹Œè»Šç«™', note: '1.æœ­å¹Œè¾²å­¸æ ¡ 2.å››å­£èŠ±ä¸¸', 
                        guide: 'ã€å¿…è²·ã€‘æœ­å¹Œè¾²å­¸æ ¡çš„ç¾çƒ¤èµ·å¸é¤…ä¹¾è¶…ç´šé¦™ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šæœ­å¹Œè¾²å­¸æ ¡ç‰›å¥¶é¤…ä¹¾ã€Press Butter Sand (åŒ—æµ·é“é™å®š)ã€ä½è—¤æ°´ç”¢é®­é­šè£½å“\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå¤§ä¸¸ç™¾è²¨ (Daimaru) åœ°ä¸‹è¡—ã€APIA åœ°ä¸‹è¡—', 
                        expenses: [] 
                    },
                    { id: 'd1-16', time: '21:00', endTime: '', type: 'transport', transportMode: 'åœ°éµ', title: 'å›é£¯åº—', location: 'Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’', note: 'åœ°éµ(å—åŒ—ç·š)', guide: 'ç©äº†ä¸€æ•´å¤©è¾›è‹¦äº†ï¼Œå›é£¯åº—ä¼‘æ¯å§ã€‚', expenses: [] },
                    { id: 'd1-17', time: '21:30', endTime: '', type: 'food', title: 'å®µå¤œï¼šéºµå±‹é›ªé¢¨', location: 'éºµå±‹é›ªé¢¨', note: 'æ‹‰éºµ', guide: 'å¦‚æœä½ é‚„åƒå¾—ä¸‹...é€™å®¶å¯æ˜¯è–„é‡æ’éšŠååº—ï¼', expenses: [] },
                ]
            },
            {
                id: 'day2',
                date: '1/10',
                weekday: 'é€±å…­',
                title: 'å°æ¨½ä¸€æ—¥éŠ',
                weather: 'snowflake',
                temp: '-4Â°C',
                items: [
                    { id: 'd2-1', time: '07:30', endTime: '', type: 'food', title: 'é£¯åº—æ—©é¤', location: 'Vessel Inn æœ­å¹Œä¸­å³¶å…¬åœ’', note: 'äº«ç”¨æ—©é¤', guide: 'é€™å®¶é£¯åº—æ—©é¤æ˜¯å…¨æ—¥æœ¬æ’åå‰å¹¾åçš„ï¼Œè«‹å‹™å¿…ç‹‚åƒæµ·é®®ä¸¼ï¼', expenses: [] },
                    { id: 'd2-2', time: '08:30', endTime: '', type: 'todo', title: 'å¯„æ”¾è¡Œæ', location: 'THE GATE HOTEL æœ­å¹Œ', note: 'è¡Œæå¯„æ”¾ç¬¬äºŒå¤©é£¯åº—', guide: 'å…ˆå»æ–°é£¯åº—æ”¾è¡Œæï¼Œè¼•è£å‰å¾€å°æ¨½ã€‚', expenses: [] },
                    { id: 'd2-3', time: '09:00', endTime: '', type: 'transport', transportMode: 'JR', title: 'æœ­å¹Œ â†’ å°æ¨½', location: 'å°æ¨½è»Šç«™', note: 'JRå‡½é¤¨æœ¬ç·š', guide: 'æ­ä¹˜ JR æ™‚ï¼Œè¨˜å¾—ç›¡é‡åå³å´åº§ä½ï¼Œå¯ä»¥çœ‹åˆ°ç¾éº—çš„æµ·æ™¯å–”ï¼', expenses: [] },
                    { 
                        id: 'd2-4', time: '10:00', endTime: '', type: 'sight', title: 'å¤©ç‹—å±±çºœè»Š', location: 'å°æ¨½å¤©ç‹—å±±', note: 'æ­ä¹˜9è™Ÿå·´å£«å¾€å¤©ç‹—å±±', 
                        guide: 'ã€å¿…çœ‹ã€‘é›»å½±ã€Šæƒ…æ›¸ã€‹ç¶“å…¸å ´æ™¯ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šå¤©ç‹—å±±é™å®šæ˜ä¿¡ç‰‡ã€åŒ—æµ·é“é›ªå…”é€±é‚Šã€å¤©ç‹—å®ˆè­·éˆ´\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå±±é ‚å±•æœ›å°ç´€å¿µå“åº—', 
                        expenses: [] 
                    },
                    { id: 'd2-5', time: '12:00', endTime: '', type: 'food', title: 'åˆé¤ï¼šä¸‰è§’å¸‚å ´', location: 'ä¸‰è§’å¸‚å ´ ã•ã‚“ã‹ãäº­', note: 'æµ·é®®ä¸¼', guide: 'å°±åœ¨å°æ¨½è»Šç«™æ—ï¼Œç¾æ’ˆç¾æ®ºçš„æµ·é®®è¶…ç´šæ–°é®®ã€‚', expenses: [] },
                    { id: 'd2-6', time: '13:00', endTime: '', type: 'transport', transportMode: 'JR', title: 'å‰å¾€å—å°æ¨½', location: 'å—å°æ¨½è»Šç«™', note: 'JRåˆ°å—å°æ¨½ç«™', guide: 'å¾å°æ¨½æ­ä¸€ç«™åˆ°å—å°æ¨½ï¼Œå¾é‚£é‚Šä¸€è·¯é€›å›å°æ¨½é‹æ²³æ˜¯æ¯”è¼ƒé †è·¯çš„èµ°æ³•ã€‚', expenses: [] },
                    { 
                        id: 'd2-7', time: '13:30', endTime: '16:00', type: 'sight', title: 'å°æ¨½æ¼«æ­¥', location: 'å°æ¨½å ºç”ºé€šã‚Šå•†åº—è¡—', note: 'è’¸æ±½é˜ã€å•†åº—è¡—ã€é‹æ²³', 
                        guide: 'è’¸æ±½é˜æ¯15åˆ†é˜æœƒå™´æ°£ä¸€æ¬¡ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šLeTAO é›™å±¤èµ·å¸è›‹ç³•(å¯å®…é…)ã€åŒ—è“æ¨“å¦–ç²¾ä¹‹æ£®å¹´è¼ªè›‹ç³•ã€å…­èŠ±äº­è‰è“å·§å…‹åŠ›\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå°æ¨½éŸ³æ¨‚ç›’å ‚æœ¬é¤¨ã€å¤§æ­£å“¨å­é¤¨ã€SNOOPY èŒ¶å±‹', 
                        expenses: [] 
                    },
                    { id: 'd2-8', time: '17:30', endTime: '', type: 'transport', transportMode: 'JR', title: 'å°æ¨½ â†’ æœ­å¹Œ', location: 'æœ­å¹Œè»Šç«™', note: 'JRå‡½é¤¨æœ¬ç·š', guide: 'å‚æ™šçš„å°æ¨½é‹æ²³é»ç‡ˆå¾ˆç¾ã€‚', expenses: [] },
                    { 
                        id: 'd2-9', time: '17:45', endTime: '', type: 'sight', title: 'æœ­å¹Œé›»è¦–å¡”', location: 'æœ­å¹Œé›»è¦–å¡”', note: '', 
                        guide: 'å›åˆ°å¤§é€šå…¬åœ’ï¼Œæ™šä¸Šçš„é›»è¦–å¡”æœƒæ‰“ç‡ˆã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šé›»è¦–å¡”çˆ¸çˆ¸(TV Dad)é€±é‚Šå•†å“ã€åŒ—æµ·é“é™å®šç£éµã€æœ­å¹Œå¤œæ™¯æ˜ä¿¡ç‰‡\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼š3æ¨“ç´€å¿µå“åº—', 
                        expenses: [] 
                    },
                    { 
                        id: 'd2-10', time: '18:00', endTime: '', type: 'sight', title: 'ç‹¸å°è·¯å•†åº—è¡—', location: 'ç‹¸å°è·¯å•†åº—è¡—', note: '', 
                        guide: 'è—¥å¦ã€ä¼´æ‰‹ç¦®ä¸€æ¬¡è²·é½Šçš„å¥½åœ°æ–¹ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šåŒ—æµ·é“é™å®šè–¯æ¢ä¸‰å…„å¼Ÿã€ç™½è‰²æˆ€äººã€æœ­å¹Œè¾²å­¸æ ¡é¤…ä¹¾ã€åŒ—æµ·é“é™å®šLuLuLuné¢è†œ\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå”å‰è¨¶å¾· (ç‹¸å°è·¯åº—)ã€Satudora (æœ­å¹Œè—¥å¦)ã€æ¥­å‹™è¶…å¸‚', 
                        expenses: [] 
                    },
                    { id: 'd2-11', time: '19:45', endTime: '', type: 'food', title: 'æ™šé¤ï¼šæˆå‰æ€æ±—çƒ¤è‚‰', location: 'ã—ã‚ãã¾ æœ­å¹Œæˆå‰æ€æ±— æœ¬åº—', note: 'æœ¬åº—', guide: 'ã€å¿…åƒã€‘åŒ—æµ·é“éˆé­‚ç¾é£Ÿï¼æ²’æœ‰ç¾Šé¨·å‘³ï¼Œåªæœ‰é®®ç”œè‚‰æ±ã€‚', expenses: [] },
                    { id: 'd2-12', time: '20:45', endTime: '', type: 'hotel', title: 'é£¯åº— Check-in', location: 'THE GATE HOTEL æœ­å¹Œ', note: '', guide: 'çµ‚æ–¼å¯ä»¥é€²æˆ¿ä¼‘æ¯äº†ã€‚', expenses: [] },
                ]
            },
            {
                id: 'day3',
                date: '1/11',
                weekday: 'é€±æ—¥',
                title: 'åœ‹éš›æ»‘é›ªå ´ & è—»å²©å±±',
                weather: 'cloudy',
                temp: '-6Â°C',
                items: [
                    { 
                        id: 'd3-1', time: '08:00', endTime: '12:00', type: 'sight', title: 'åœ‹éš›æ»‘é›ªå ´', location: 'æœ­å¹Œå›½éš›ã‚¹ã‚­ãƒ¼å ´', note: 'é›†åˆé»: INFINITY CITY', 
                        guide: 'é€™è£¡çš„ç²‰é›ªå“è³ªè¶…å¥½ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šæ»‘é›ªå ´é™å®šè²¼ç´™/å¾½ç« ã€åŒ—æµ·é“é™å®šæ¯éºµ(ä¼‘æ¯æ™‚åƒ)ã€æ»‘é›ªå ´é™å®šæ¯›å¸½\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šæ»‘é›ªå ´é™„è¨­å•†åº— (è³¼è²·è£å‚™æˆ–ç´€å¿µå“)', 
                        expenses: [] 
                    },
                    { id: 'd3-2', time: '12:00', endTime: '13:00', type: 'food', title: 'åˆé¤', location: 'æœ­å¹Œå›½éš›ã‚¹ã‚­ãƒ¼å ´', note: 'æ»‘é›ªå ´å…§ç”¨é¤', guide: 'æ»‘é›ªå ´çš„å’–å“©é£¯æˆ–æ‹‰éºµåœ¨å†°å¤©é›ªåœ°è£¡åƒèµ·ä¾†ç‰¹åˆ¥ç¾å‘³ã€‚', expenses: [] },
                    { id: 'd3-3', time: '13:00', endTime: '16:00', type: 'sight', title: 'ç¹¼çºŒæ»‘é›ª', location: 'æœ­å¹Œå›½éš›ã‚¹ã‚­ãƒ¼å ´', note: '', guide: 'ä¸‹åˆé›ªæ³å¯èƒ½æœƒè®Šï¼Œæ³¨æ„å®‰å…¨ã€‚', expenses: [] },
                    { id: 'd3-4', time: '17:30', endTime: '', type: 'transport', transportMode: 'å·´å£«', title: 'è¿”å›å¸‚å€', location: 'INFINITY CITY', note: 'è¿”å› INFINITY CITY', guide: 'æ»‘å®Œé›ªèº«é«”æœƒå¾ˆç–²æ†Šï¼Œå›ç¨‹è»Šä¸Šå¥½å¥½è£œçœ å§ã€‚', expenses: [] },
                    { 
                        id: 'd3-5', time: '18:10', endTime: '', type: 'sight', title: 'è—»å²©å±±çºœè»Šå¤œæ™¯', location: 'è—»å²©å±±', note: '', 
                        guide: 'ã€å¿…çœ‹ã€‘æ—¥æœ¬æ–°ä¸‰å¤§å¤œæ™¯ä¹‹ä¸€ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šå¹¸ç¦ä¹‹é˜åŠé£¾ã€è—»å²©å±±é™å®šæ˜Ÿæ˜Ÿé¤…ä¹¾ã€å¤œæ™¯æ˜ä¿¡ç‰‡\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå±±é ‚å±•æœ›å°å•†åº—ã€ŒMt.MOIWA SOUVENIR SHOPã€', 
                        expenses: [] 
                    },
                    { id: 'd3-6', time: '20:00', endTime: '', type: 'food', title: 'æ™šé¤ï¼šè¿´è½‰å£½å¸', location: 'å›è»¢å¯¿ã— ãƒˆãƒªãƒˆãƒ³ å¹³å²¸åº—', note: 'Toriton å£½å¸ (æ­è¨ˆç¨‹è»Š)', guide: 'é€™å®¶æ˜¯ç•¶åœ°äººä¹Ÿå¤§æ’é•·é¾çš„ååº—ï¼Œé£Ÿææ–°é®®åº¦æ²’è©±èªªã€‚', expenses: [] },
                    { id: 'd3-7', time: '21:00', endTime: '', type: 'hotel', title: 'å›é£¯åº—', location: 'THE GATE HOTEL æœ­å¹Œ', note: '', guide: 'ä»Šå¤©é‹å‹•é‡å¾ˆå¤§ï¼Œæ™šä¸Šå¯ä»¥æ³¡å€‹æ¾¡æ”¾é¬†è‚Œè‚‰ã€‚', expenses: [] },
                ]
            },
            {
                id: 'day4',
                date: '1/12',
                weekday: 'é€±ä¸€',
                title: 'ç™»åˆ¥ã€æ´çˆºæ¹–',
                weather: 'sun',
                temp: '-1Â°C',
                items: [
                    { id: 'd4-1', time: '07:30', endTime: '08:44', type: 'transport', transportMode: 'JR', title: 'æœ­å¹Œ â†’ ç™»åˆ¥', location: 'ç™»åˆ¥è»Šç«™', note: 'JR åŒ—æ–—è™Ÿ', guide: 'å¾ä»Šå¤©é–‹å§‹å¾€é“å—ç§»å‹•ï¼ŒJR æ²¿é€”å¯èƒ½æœƒçœ‹åˆ°æµ·ã€‚', expenses: [] },
                    { 
                        id: 'd4-2', time: '09:00', endTime: '', type: 'sight', title: 'å°¼å…‹æ–¯æµ·æ´‹å…¬åœ’', location: 'ç™»åˆ¥å°¼å…‹æ–¯æµ·æ´‹å…¬åœ’', note: 'æ°´æ—é¤¨', 
                        guide: 'ä¼éµéŠè¡Œæ˜¯å¿…çœ‹é‡é»ï¼\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šä¼éµç©å¶/æŠ±æ•ã€æµ·æ´‹å…¬åœ’é™å®šå¥¶æ²¹é¤…ä¹¾ã€æµ·è±šé‘°åŒ™åœˆ\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šåœ’å€å‡ºå£ç´€å¿µå“åº—', 
                        expenses: [] 
                    },
                    { id: 'd4-3', time: '11:45', endTime: '11:59', type: 'transport', transportMode: 'å…¬è»Š', title: 'å‰å¾€ç™»åˆ¥æº«æ³‰', location: 'ç™»åˆ¥æº«æ³‰', note: 'é“å—å·´å£«', guide: 'å·´å£«ç­æ¬¡å›ºå®šï¼Œè«‹ã€å‹™å¿…ã€‘æº–æ™‚åˆ°ç«™ç‰Œç­‰è»Šã€‚', expenses: [] },
                    { id: 'd4-4', time: '12:00', endTime: '', type: 'food', title: 'åˆé¤ï¼šæ¹¯å’–å“©', location: 'é“ç”£å­ã·ã‚Šã‚“', note: 'é“ç”£å­ã·ã‚Šã‚“æ¹¯å’–å“©', guide: 'ç™»åˆ¥æº«æ³‰è¡—ä¸Šçš„éš±è—ç¾é£Ÿï¼Œé™¤äº†æ¹¯å’–å“©ï¼Œä»–å€‘çš„å¸ƒä¸ä¹Ÿå¾ˆæœ‰åå–”ï¼', expenses: [] },
                    { 
                        id: 'd4-5', time: '13:00', endTime: '14:40', type: 'sight', title: 'ç™»åˆ¥ç†Šç‰§å ´', location: 'ç™»åˆ¥ç†Šç‰§å ´', note: '', 
                        guide: 'é€™è£¡çš„æ£•ç†Šæœƒè·ŸéŠå®¢æ‹›æ‰‹è¨é£Ÿç‰©åƒã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šã€Œç†Šå‡ºæ²’æ³¨æ„ã€å‘¨é‚Šå•†å“(æ‹‰éºµ/Tæ¤)ã€ç´”æ­£ç†Šæ²¹ä¿é¤Šéœœã€æœ¨é›•ç†Šæ“ºé£¾\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå±±é ‚çºœè»Šç«™è³£åº—', 
                        expenses: [] 
                    },
                    { id: 'd4-6', time: '15:15', endTime: '15:27', type: 'transport', transportMode: 'å…¬è»Š', title: 'è¿”å›ç™»åˆ¥è»Šç«™', location: 'ç™»åˆ¥è»Šç«™', note: 'é“å—å·´å£«', guide: 'è¦æº–å‚™å»æ´çˆºæ¹–äº†ï¼Œæ³¨æ„å·´å£«æ™‚é–“ã€‚', expenses: [] },
                    { id: 'd4-7', time: '15:59', endTime: '16:38', type: 'transport', transportMode: 'JR', title: 'ç™»åˆ¥ â†’ æ´çˆºæ¹–', location: 'æ´çˆºè»Šç«™', note: 'JR åŒ—æ–—è™Ÿ', guide: 'çŸ­çŸ­çš„è»Šç¨‹ï¼Œå¯ä»¥ç¨ä½œä¼‘æ¯ã€‚', expenses: [] },
                    { id: 'd4-8', time: '17:05', endTime: '17:26', type: 'transport', transportMode: 'å…¬è»Š', title: 'æ´çˆºè»Šç«™ â†’ ä¸­å¤®é€š', location: 'æ´çˆºæ¹–ä¸‡ä¸–é–£', note: 'é“å—å·´å£«', guide: 'æŠµé”æ´çˆºæ¹–æº«æ³‰å€ï¼Œæº–å‚™å…¥ä½ä»Šæ™šçš„æº«æ³‰é£¯åº—ã€‚', expenses: [] },
                    { id: 'd4-9', time: '17:26', endTime: '', type: 'hotel', title: 'é£¯åº— Check-in', location: 'æ´çˆºæ¹–ä¸‡ä¸–é–£', note: '', guide: 'ä¸‡ä¸–é–£çš„æ¹–æ™¯å¾ˆç¾ï¼Œé‚„æœ‰éœ²å¤©æº«æ³‰ã€‚', expenses: [] },
                    { id: 'd4-10', time: '18:00', endTime: '', type: 'food', title: 'æ™šé¤', location: 'æ´çˆºæ¹–ä¸‡ä¸–é–£', note: 'é£¯åº—è‡ªåŠ©é¤', guide: 'ç›¡æƒ…äº«ç”¨è‡ªåŠ©é¤å§ï¼Œåˆ¥å¿˜äº†è©¦è©¦åŒ—æµ·é“çš„ç”œé»ã€‚', expenses: [] },
                ]
            },
            {
                id: 'day5',
                date: '1/13',
                weekday: 'é€±äºŒ',
                title: 'æ´çˆºæ¹–ã€å‡½é¤¨',
                weather: 'cloudy',
                temp: '0Â°C',
                items: [
                    { id: 'd5-1', time: '09:00', endTime: '09:45', type: 'sight', title: 'æ´çˆºæ¹–æ±½èˆ¹', location: 'æ´çˆºæ¹–æ±½èˆ¹', note: 'èµ°è·¯å‰å¾€', guide: 'æ­èˆ¹éŠè¦½æ´çˆºæ¹–ï¼Œæ¹–ä¸­å³¶åœ¨å†¬å¤©çœ‹åˆ¥æœ‰ä¸€ç•ªé¢¨å‘³ã€‚', expenses: [] },
                    { id: 'd5-2', time: '10:20', endTime: '', type: 'transport', transportMode: 'å…¬è»Š', title: 'å‰å¾€å±•æœ›å°', location: 'ã‚µã‚¤ãƒ­å±•æœ›å°', note: 'æº«æ³‰è¡—å·´å£« (10:20ä¸Šè»Š)', guide: 'é–‹å§‹ä»Šå¤©çš„å·´å£«æ¥åŠ›è³½ï¼Œæ™‚é–“è¦æŠ“æº–å–”ï¼', expenses: [] },
                    { 
                        id: 'd5-3', time: '10:40', endTime: '10:55', type: 'sight', title: 'Silo å±•æœ›å°', location: 'ã‚µã‚¤ãƒ­å±•æœ›å°', note: 'åƒ…åœç•™15åˆ†é˜', 
                        guide: 'ä¿¯ç°æ´çˆºæ¹–å…¨æ™¯çš„æœ€ä½³åœ°é»ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šæ´çˆºæ¹–å¸ƒä¸ã€ç‰§å®¶æ°£çƒå¸ƒä¸(Bocca)ã€åŒ—æµ·é“è–°è¡£è‰ç²¾æ²¹\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå±•æœ›å°è³£åº— (åªæœ‰15åˆ†é˜è¦å¿«ï¼)', 
                        expenses: [] 
                    },
                    { id: 'd5-4', time: '10:55', endTime: '11:16', type: 'transport', transportMode: 'å…¬è»Š', title: 'å‰å¾€æ«»ç”º', location: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æœ›ç¾Šè¹„', note: 'å·´å£« (10:55ä¸Šè»Š) ã€å‹™å¿…ã€‘æ­åˆ°æ­¤ç­', guide: 'éŒ¯éé€™ç­è»Šæœƒå½±éŸ¿å¾Œé¢çš„åˆé¤å’Œè¡Œç¨‹ï¼Œè«‹æå‰åœ¨ç«™ç‰Œç­‰å€™ã€‚', expenses: [] },
                    { id: 'd5-5', time: '11:30', endTime: '', type: 'food', title: 'åˆé¤ï¼šæœ›ç¾Šè¹„', location: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æœ›ç¾Šè¹„', note: 'æ—¥å¼æ´‹é£Ÿ', guide: 'é€™å®¶æ˜¯æ´çˆºæ¹–éå¸¸æœ‰åçš„è€å­—è™Ÿæ´‹é£Ÿåº—ï¼Œæ¼¢å ¡æ’å’Œè›‹åŒ…é£¯æ˜¯æ‹›ç‰Œã€‚', expenses: [] },
                    { id: 'd5-6', time: '12:45', endTime: '13:00', type: 'transport', transportMode: 'å…¬è»Š', title: 'å‰å¾€æ˜­å’Œæ–°å±±', location: 'æ˜­å’Œæ–°å±±', note: 'å·´å£« (12:45ä¸Šè»Š)', guide: 'åƒé£½å–è¶³ï¼Œå‰å¾€æ´»ç«å±±æ˜­å’Œæ–°å±±ã€‚', expenses: [] },
                    { 
                        id: 'd5-7', time: '13:00', endTime: '14:35', type: 'sight', title: 'æœ‰ç å±±å±•æœ›å°', location: 'æœ‰ç å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ã‚¤', note: '', 
                        guide: 'å¯ä»¥çœ‹åˆ°ç«å±±å£å’Œå™´ç™¼éºè·¡ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šæœ‰ç å±±é™å®šTæ¤ã€ç«å±±ç°æ´—é¢ä¹³/è‚¥çš‚ã€æ´çˆºæ¹–æœ¨åˆ€(éŠ€é­‚è¿·å¿…è²·)\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šç«å±±å£åŸå‰µå•†åº—ã€æ˜­å’Œæ–°å±±åœŸç”¢è¡—', 
                        expenses: [] 
                    },
                    { id: 'd5-8', time: '14:35', endTime: '14:43', type: 'transport', transportMode: 'å…¬è»Š', title: 'è¿”å›ä¸­å¤®é€š', location: 'æ´çˆºæ¹–ä¸‡ä¸–é–£', note: 'å·´å£« (14:35ä¸Šè»Š) ã€å‹™å¿…ã€‘æ­åˆ°', guide: 'æº–å‚™å›å»æ‹¿è¡Œæäº†ã€‚', expenses: [] },
                    { id: 'd5-9', time: '14:43', endTime: '14:53', type: 'todo', title: 'æ‹¿è¡Œæ', location: 'æ´çˆºæ¹–ä¸‡ä¸–é–£', note: '', guide: 'è¿…é€Ÿé ˜å–è¡Œæï¼Œæº–å‚™å‰å¾€è»Šç«™ã€‚', expenses: [] },
                    { id: 'd5-10', time: '15:55', endTime: '16:23', type: 'transport', transportMode: 'å…¬è»Š', title: 'å‰å¾€æ´çˆºè»Šç«™', location: 'æ´çˆºè»Šç«™', note: 'å·´å£« (15:55ä¸Šè»Š)', guide: 'å’Œæ´çˆºæ¹–èªªå†è¦‹ï¼Œå‰å¾€ä¸‹ä¸€å€‹åŸå¸‚ã€‚', expenses: [] },
                    { id: 'd5-11', time: '16:38', endTime: '18:30', type: 'transport', transportMode: 'JR', title: 'æ´çˆºæ¹– â†’ å‡½é¤¨', location: 'å‡½é¤¨è»Šç«™', note: 'JR åŒ—æ–—è™Ÿ', guide: 'å»ºè­°åœ¨æ´çˆºè»Šç«™è²·é»é›¶é£Ÿæˆ–ä¾¿ç•¶ï¼Œé€™æ®µè»Šç¨‹ç´„å…©å°æ™‚ã€‚', expenses: [] },
                    { id: 'd5-12', time: '19:00', endTime: '19:30', type: 'hotel', title: 'å¯„æ”¾è¡Œæ', location: 'La Vista å‡½é¤¨ç£', note: 'è¨ˆç¨‹è»Šæˆ–è·¯é¢é›»è»Š', guide: 'La Vista çš„æ—©é¤æ˜¯å…¨æ—¥æœ¬ç¬¬ä¸€åï¼ä»Šæ™šä½é€™å¤ªå¹¸ç¦äº†ã€‚', expenses: [] },
                    { 
                        id: 'd5-13', time: '19:30', endTime: '', type: 'sight', title: 'å‡½é¤¨å±±å¤œæ™¯', location: 'å‡½é¤¨å±±', note: 'è¨ˆç¨‹è»Šå‰å¾€çºœè»Šç«™', 
                        guide: 'ã€å¿…çœ‹ã€‘ä¸–ç•Œä¸‰å¤§å¤œæ™¯ï¼é›™Cåœ°å½¢éå¸¸è¿·äººã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šå‡½é¤¨å±±å¤œæ™¯åŒ…è£å·§å…‹åŠ›ã€å‡½é¤¨å±±é™å®šTæ¤ã€çƒè³Šé£¯çœŸç©ºåŒ…\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå±±é ‚å•†åº— Cremona (2æ¨“)', 
                        expenses: [] 
                    },
                    { id: 'd5-14', time: '21:00', endTime: '', type: 'food', title: 'æ™šé¤', location: 'å‡½é¤¨', note: 'é¹½æ‹‰éºµ ã‚ã˜ã•ã„ æˆ– ç¾Šç¾Šäº­', guide: 'å‡½é¤¨çš„é¹½å‘³æ‹‰éºµæ¹¯é ­æ¸…æ¾ˆé®®ç¾ï¼Œã‚ã˜ã•ã„ (å‘³å½©) æ˜¯ååº—ã€‚', expenses: [] },
                    { id: 'd5-15', time: '22:00', endTime: '', type: 'hotel', title: 'å›é£¯åº—', location: 'La Vista å‡½é¤¨ç£', note: '', guide: 'æ™šä¸Šå¯ä»¥å»é ‚æ¨“çš„å¤§æµ´å ´æ³¡æ¹¯ï¼Œé‚„å¯ä»¥çœ‹è‘—å¤œæ™¯åƒå†°æ£’ï¼', expenses: [] },
                ]
            },
            {
                id: 'day6',
                date: '1/14',
                weekday: 'é€±ä¸‰',
                title: 'å‡½é¤¨ (é‡‘æ£®å€‰åº«ã€äº”ç¨œéƒ­)',
                weather: 'snow',
                temp: '-3Â°C',
                items: [
                    { id: 'd6-1', time: '07:00', endTime: '09:00', type: 'food', title: 'é£¯åº—è±ªè¯æ—©é¤', location: 'La Vista å‡½é¤¨ç£', note: '', guide: 'ã€å¿…åƒã€‘é‡é ­æˆ²ä¾†äº†ï¼é®­é­šåµã€ç”œè¦ã€ç”Ÿå¹²è²éš¨ä½ åƒåˆ°é£½ï¼Œè‡ªè£½è¶…è±ªè¯æµ·é®®ä¸¼ï¼', expenses: [] },
                    { 
                        id: 'd6-2', time: '10:00', endTime: '12:00', type: 'sight', title: 'é‡‘æ£®ç´…ç£šå€‰åº«', location: 'é‡‘æ£®èµ¤ãƒ¬ãƒ³ã‚¬å€‰åº«', note: 'èµ°è·¯å‰å¾€', 
                        guide: 'å°±åœ¨é£¯åº—æ—é‚Šï¼Œç´…ç£šå»ºç¯‰å¾ˆå¥½æ‹ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šSNAFFLE\'S èµ·å¸è›‹ç³•ã€Petite Merveille ä¸€å£èµ·å¸è›‹ç³•ã€å‡½é¤¨æ­¦å°‡é¤¨å‘¨é‚Š\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šé‡‘æ£®æ´‹ç‰©é¤¨ã€å‡½é¤¨æ˜æ²»é¤¨', 
                        expenses: [] 
                    },
                    { id: 'd6-3', time: '12:00', endTime: '13:00', type: 'food', title: 'åˆé¤ï¼šå°ä¸‘æ¼¢å ¡', location: 'ãƒ©ãƒƒã‚­ãƒ¼ãƒ”ã‚¨ãƒ­', note: '', guide: 'ã€å¿…åƒã€‘å‡½é¤¨é™å®šï¼åªæœ‰å‡½é¤¨æ‰åƒå¾—åˆ°ã€‚æ¨è–¦ç¬¬ä¸€åçš„ã€Œä¸­è¯é›è…¿æ¼¢å ¡ã€ï¼Œä»½é‡è¶…å¤§ã€‚', expenses: [] },
                    { id: 'd6-4', time: '13:00', endTime: '15:00', type: 'sight', title: 'é€›è¡—/æ¡è²·', location: 'é‡‘æ£®èµ¤ãƒ¬ãƒ³ã‚¬å€‰åº«', note: '', guide: 'æœ€å¾Œçš„æ¡è²·æ©Ÿæœƒï¼ŒSNAFFLE\'S çš„èµ·å¸è›‹ç³•æ˜¯å‡½é¤¨åç”¢ï¼Œå¯ä»¥è²·ä¾†ç•¶é»å¿ƒã€‚', expenses: [] },
                    { id: 'd6-5', time: '15:00', endTime: '16:00', type: 'hotel', title: 'æ›é£¯åº—', location: 'La\'gent Stay å‡½é¤¨ç«™å‰', note: 'æ”¾è¡Œæ', guide: 'ç‚ºäº†æ˜å¤©å»æ©Ÿå ´æ–¹ä¾¿ï¼Œä»Šæ™šä½åœ¨è»Šç«™æ—çš„é£¯åº—ã€‚', expenses: [] },
                    { 
                        id: 'd6-6', time: '17:00', endTime: '18:30', type: 'sight', title: 'äº”ç¨œéƒ­å¡”', location: 'äº”ç¨œéƒ­ã‚¿ãƒ¯ãƒ¼', note: 'è·¯é¢é›»è»Š', 
                        guide: 'ç™»ä¸Šå¡”é ‚å¯ä»¥çœ‹åˆ°å®Œæ•´çš„æ˜Ÿå½¢å ¡å£˜äº”ç¨œéƒ­ã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šäº”ç¨œéƒ­æœ€ä¸­é¤…ã€åœŸæ–¹æ­²ä¸‰ç›¸é—œé€±é‚Šã€ç®±é¤¨å¥‰è¡Œæ‰€ç³–æœ\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šäº”ç¨œéƒ­å¡”è³£åº— (1æ¨“ & å±•æœ›å°)', 
                        expenses: [] 
                    },
                    { id: 'd6-7', time: '18:30', endTime: '20:00', type: 'food', title: 'æ™šé¤ï¼šç‡’è‚‰ç‰©èª', location: 'ç„¼è‚‰ç‰©èª ç‰›è‹¥', note: 'åˆ¥é¤¨', guide: 'åŒ—æµ·é“ä¹‹æ—…çš„æœ€å¾Œä¸€é “æ™šé¤ï¼Œç”¨ç¾å‘³çš„ç‡’è‚‰ä¾†ç•«ä¸‹å¥é»å§ï¼', expenses: [] },
                    { id: 'd6-8', time: '20:00', endTime: '21:00', type: 'hotel', title: 'å›é£¯åº—', location: 'La\'gent Stay å‡½é¤¨ç«™å‰', note: '', guide: 'æ•´ç†è¡Œæï¼ŒæŠŠæˆ°åˆ©å“å¡å¥½å¡æ»¿ã€‚', expenses: [] },
                ]
            },
            {
                id: 'day7',
                date: '1/15',
                weekday: 'é€±å››',
                title: 'å†è¦‹åŒ—æµ·é“',
                weather: 'cloudy',
                temp: '1Â°C',
                items: [
                    { id: 'd7-1', time: '08:00', endTime: '09:00', type: 'food', title: 'é£¯åº—æ—©é¤', location: 'La\'gent Stay å‡½é¤¨ç«™å‰', note: '', guide: 'æ‚ é–’åœ°åƒå€‹æ—©é¤ï¼Œæª¢æŸ¥æ±è¥¿æœ‰æ²’æœ‰å¸¶é½Šã€‚', expenses: [] },
                    { 
                        id: 'd7-2', time: '09:00', endTime: '11:00', type: 'transport', transportMode: 'JR', title: 'å‰å¾€æ©Ÿå ´', location: 'å‡½é¤¨æ©Ÿå ´', note: 'JR/å·´å£«', 
                        guide: 'å¾å‡½é¤¨è»Šç«™æœ‰ç›´é”æ©Ÿå ´çš„å·´å£«ï¼Œæ¯”è¼ƒæ–¹ä¾¿ä¸ç”¨æ¬è¡Œæã€‚\n\nã€æ¨è–¦ä¼´æ‰‹ç¦®ã€‘ï¼šå‡½é¤¨æ•£æ­¥(ç”œé»)ã€çƒè³Šå¾·åˆ©(å¯ä»¥å–é…’çš„çƒè³Šé…’å£º)ã€å‡½é¤¨ç‰›å¥¶\nã€æ¨è–¦è³¼ç‰©ã€‘ï¼šå‡½é¤¨æ©Ÿå ´åœ‹å…§ç·šèˆªå»ˆ 2F è³£åº—', 
                        expenses: [] 
                    },
                ]
            }
        ];

        // --- å¤©æ°£åœ–ç¤ºå…ƒä»¶ ---
        const WeatherIcon = ({ type, className }) => {
            if (type === 'sun') return <Icon name="sun" className={`text-orange-400 ${className}`} />;
            if (type === 'cloud') return <Icon name="cloud" className={`text-gray-400 ${className}`} />;
            if (type === 'cloud-snow' || type === 'snowflake' || type === 'snow') return <Icon name="snowflake" className={`text-blue-300 ${className}`} />;
            return <Icon name="sun" className={`text-orange-400 ${className}`} />;
        };

        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 }).format(amount);
        };

        const formatTWD = (amount) => {
            return new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(amount);
        };

        const handleGoogleMap = (location) => {
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
        };

        // --- é¦–é å…ƒä»¶ ---
        const HomePage = ({ onEnter, itinerary }) => {
            const [timeLeft, setTimeLeft] = useState('');

            useEffect(() => {
                const tripDate = new Date('2026-01-09T00:00:00');
                const timer = setInterval(() => {
                    const now = new Date();
                    const diff = tripDate - now;
                    if (diff <= 0) {
                        setTimeLeft('æ—…ç¨‹é€²è¡Œä¸­ï¼');
                    } else {
                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        setTimeLeft(`å€’æ•¸ ${days} å¤© ${hours} å°æ™‚`);
                    }
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            return (
                <div className="min-h-screen relative flex flex-col items-center justify-center p-6 overflow-hidden bg-[#f7f3e8]">
                    <div className="absolute top-0 right-0 w-64 h-64 bg-green-100 rounded-full mix-blend-multiply filter blur-3xl opacity-50 -mr-16 -mt-16 animate-pulse" />
                    <div className="absolute bottom-0 left-0 w-64 h-64 bg-blue-100 rounded-full mix-blend-multiply filter blur-3xl opacity-50 -ml-16 -mb-16 animate-pulse" />
                    
                    <div className="relative z-20 w-full max-w-md glass-card rounded-[40px] shadow-2xl p-8 border border-white/50 text-center animate-fade-in">
                        <div className="mb-4 flex justify-center">
                            <div className="bg-[#556b2f]/10 p-4 rounded-full shadow-inner border border-[#556b2f]/20">
                                <Icon name="plane" size={40} className="text-[#556b2f] transform -rotate-45" />
                            </div>
                        </div>
                        <h1 className="text-3xl font-black text-[#556b2f] mb-1 tracking-tight">HOKKAIDO</h1>
                        <p className="text-gray-500 text-xs font-medium tracking-[0.2em] mb-6 uppercase">1/9 - 1/15 Journey</p>
                        
                        <div className="bg-[#cd853f] text-white py-3 px-6 rounded-2xl mb-8 shadow-lg shadow-orange-900/10 transform rotate-1">
                            <p className="font-bold text-lg">{timeLeft}</p>
                        </div>
                        
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            {itinerary.map((day) => (
                                <button key={day.id} onClick={() => onEnter(day.id)} className="bg-white/60 hover:bg-white p-3 rounded-2xl shadow-sm text-left transition-all border border-gray-100 flex items-center gap-3 group active:scale-95">
                                    <div className="bg-[#556b2f]/10 text-[#556b2f] w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs group-hover:bg-[#556b2f] group-hover:text-white transition-colors">
                                        {day.date.split('/')[1]}
                                    </div>
                                    <div className="flex flex-col overflow-hidden">
                                        <div className="text-[10px] text-gray-400 font-bold">{day.weekday}</div>
                                        <div className="font-bold text-gray-700 text-xs truncate">{day.title}</div>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- ä¸»æ‡‰ç”¨ç¨‹å¼ ---
        function App() {
            const [view, setView] = useState('home');
            const [activeDay, setActiveDay] = useState('day1');
            const [itinerary, setItinerary] = useState(defaultItinerary);
            const [exchangeRate, setExchangeRate] = useState(0.22);
            const [editMode, setEditMode] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [isChatOpen, setIsChatOpen] = useState(false); // AI èŠå¤©å®¤ç‹€æ…‹
            
            // æ‹–æ›³ç›¸é—œç‹€æ…‹
            const [draggedItemIndex, setDraggedItemIndex] = useState(null);

            // è³‡æ–™æŒä¹…åŒ–
            useEffect(() => {
                const saved = localStorage.getItem('hokkaido_final_v8');
                if (saved) {
                    try {
                        setItinerary(JSON.parse(saved));
                    } catch(e) {
                        console.error("Data Parse Error", e);
                    }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('hokkaido_final_v8', JSON.stringify(itinerary));
            }, [itinerary]);

            const currentDayData = useMemo(() => 
                itinerary.find(d => d.id === activeDay) || itinerary[0]
            , [itinerary, activeDay]);

            // è¨ˆç®—é›™å¹£åˆ¥ç¸½è¨ˆ
            const expenses = useMemo(() => {
                let dayTotalJPY = 0;
                let grandTotalJPY = 0;
                
                itinerary.forEach(day => {
                    day.items.forEach(item => {
                        const itemTotal = item.expenses 
                            ? item.expenses.reduce((sum, exp) => sum + (parseFloat(exp.amount) || 0), 0)
                            : (parseFloat(item.cost) || 0);
                        
                        grandTotalJPY += itemTotal;
                        if (day.id === activeDay) dayTotalJPY += itemTotal;
                    });
                });

                return { 
                    dayTotalJPY, 
                    dayTotalTWD: Math.round(dayTotalJPY * exchangeRate),
                    grandTotalJPY,
                    grandTotalTWD: Math.round(grandTotalJPY * exchangeRate)
                };
            }, [itinerary, activeDay, exchangeRate]);

            const handleUpdateItem = (dayId, updatedItem) => {
                setItinerary(prev => prev.map(day => {
                    if (day.id === dayId) {
                        return { ...day, items: day.items.map(i => i.id === updatedItem.id ? updatedItem : i) };
                    }
                    return day;
                }));
                setEditingItem(null);
            };

            const handleAddItem = (dayId) => {
                const newItem = {
                    id: Date.now().toString(),
                    time: '12:00',
                    endTime: '',
                    type: 'todo',
                    transportMode: '',
                    title: 'æ–°è¡Œç¨‹',
                    location: '',
                    note: '',
                    guide: '',
                    expenses: []
                };
                setItinerary(prev => prev.map(day => {
                    if (day.id === dayId) {
                        return { ...day, items: [...day.items, newItem] }; // æ–°å¢æ™‚ä¸è‡ªå‹•æ’åºï¼Œæ’åœ¨æœ€å¾Œ
                    }
                    return day;
                }));
                setEditingItem({...newItem, dayId});
            };

            const handleDeleteItem = (dayId, itemId) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) {
                    setItinerary(prev => prev.map(day => {
                        if (day.id === dayId) {
                            return { ...day, items: day.items.filter(i => i.id !== itemId) };
                        }
                        return day;
                    }));
                    setEditingItem(null);
                }
            };

            // --- æ‹–æ›³è™•ç†å‡½å¼ ---
            const handleDragStart = (e, index) => {
                setDraggedItemIndex(index);
                e.dataTransfer.effectAllowed = "move";
                e.dataTransfer.setData("text/plain", index); // Firefox éœ€è¦
                // è®“æ‹–æ›³çš„åŸå§‹å…ƒç´ è®ŠåŠé€æ˜
                setTimeout(() => {
                    if(e.target) e.target.classList.add('dragging');
                }, 0);
            };

            const handleDragEnd = (e) => {
                if(e.target) e.target.classList.remove('dragging');
                setDraggedItemIndex(null);
            };

            const handleDragOver = (e, index) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = "move";
            };

            const handleDrop = (e, dropIndex) => {
                e.preventDefault();
                if (draggedItemIndex === null || draggedItemIndex === dropIndex) return;

                const newItinerary = [...itinerary];
                const dayIndex = newItinerary.findIndex(d => d.id === activeDay);
                const dayItems = [...newItinerary[dayIndex].items];
                
                // ç§»å‹•é™£åˆ—å…ƒç´ 
                const [draggedItem] = dayItems.splice(draggedItemIndex, 1);
                dayItems.splice(dropIndex, 0, draggedItem);
                
                newItinerary[dayIndex].items = dayItems;
                setItinerary(newItinerary);
            };

            if (view === 'home') {
                return <HomePage itinerary={itinerary} onEnter={(id) => { setActiveDay(id); setView('itinerary'); }} />;
            }

            return (
                <div className="min-h-screen pb-40 bg-[#f7f3e8]">
                    {/* Header */}
                    <header className="fixed top-0 left-0 right-0 z-50 bg-white/90 backdrop-blur-md shadow-sm p-4 pt-6 rounded-b-[32px] border-b border-gray-100 transition-all duration-300">
                        <div className="max-w-md mx-auto">
                            <div className="flex justify-between items-center mb-4">
                                <button onClick={() => setView('home')} className="p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-600">
                                    <Icon name="chevron-left" size={28} />
                                </button>
                                <div className="text-center">
                                    <h1 className="font-black text-[#556b2f] text-lg leading-tight">1/{currentDayData.date.split('/')[1]} ({currentDayData.weekday})</h1>
                                    <p className="text-[10px] text-gray-500 font-bold tracking-widest uppercase">{currentDayData.title}</p>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setShowSettings(!showSettings)} className="p-2 bg-gray-50 rounded-xl text-gray-600">
                                        <Icon name="settings" size={20} />
                                    </button>
                                    <button onClick={() => setEditMode(!editMode)} className={`p-2 rounded-xl transition-all shadow-md ${editMode ? 'bg-orange-500 text-white shadow-orange-200' : 'bg-white text-[#556b2f] shadow-gray-100'}`}>
                                        <Icon name={editMode ? "check" : "edit-3"} size={20} />
                                    </button>
                                </div>
                            </div>
                            
                            {showSettings && (
                                <div className="mb-4 bg-white p-4 rounded-2xl shadow-lg border border-gray-100 animate-fade-in">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-xs font-bold text-gray-600">åŒ¯ç‡è¨­å®š (JPYâ†’TWD)</span>
                                        <input type="number" step="0.001" value={exchangeRate} onChange={e => setExchangeRate(parseFloat(e.target.value))} className="bg-gray-50 rounded-lg p-2 text-right w-20 text-sm font-bold text-gray-700" />
                                    </div>
                                    <button onClick={() => { if(confirm('ç¢ºå®šé‡ç½®ï¼Ÿæ‰€æœ‰ä¿®æ”¹å°‡æœƒæ¶ˆå¤±ã€‚')) { localStorage.removeItem('hokkaido_final_v8'); window.location.reload(); }}} className="w-full py-2 bg-red-50 text-red-500 rounded-lg text-xs font-bold mt-2">
                                        é‡ç½®æ‰€æœ‰è³‡æ–™
                                    </button>
                                </div>
                            )}

                            <div className="flex overflow-x-auto gap-3 no-scrollbar pb-1 snap-x">
                                {itinerary.map(day => (
                                    <button 
                                        key={day.id} 
                                        onClick={() => setActiveDay(day.id)} 
                                        className={`flex-shrink-0 w-12 h-14 rounded-2xl flex flex-col items-center justify-center transition-all snap-center ${activeDay === day.id ? 'bg-[#556b2f] text-white shadow-lg shadow-[#556b2f]/30' : 'bg-white text-gray-500 border border-gray-100'}`}
                                    >
                                        <span className="text-[10px] font-bold opacity-80">{day.date.split('/')[1]}</span>
                                        <span className="text-sm font-black">{day.weekday.slice(1,2)}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="pt-48 px-5 space-y-4 max-w-md mx-auto">
                        <div className="bg-white p-4 rounded-3xl shadow-sm border border-gray-50 flex items-center justify-between">
                             <div className="flex items-center gap-2">
                                <WeatherIcon type={currentDayData.weather} className="w-6 h-6" />
                                <span className="font-bold text-gray-700">{currentDayData.temp}</span>
                             </div>
                             <span className="text-xs text-gray-500 font-bold">ä»Šæ—¥å¤©æ°£</span>
                        </div>

                        {currentDayData.items.map((item, index) => (
                            <div key={item.id} 
                                draggable={editMode}
                                onDragStart={(e) => handleDragStart(e, index)}
                                onDragOver={(e) => handleDragOver(e, index)}
                                onDrop={(e) => handleDrop(e, index)}
                                onDragEnd={handleDragEnd}
                                onClick={() => editMode && setEditingItem({...item, dayId: activeDay})}
                                className={`relative bg-white p-5 rounded-[28px] shadow-sm border border-gray-100 group transition-all select-none
                                    ${editMode ? 'cursor-move' : 'cursor-pointer active:scale-[0.98]'}`}
                            >
                                <div className="flex justify-between items-start mb-3">
                                    <div className="flex flex-col">
                                        <div className="flex items-center gap-2 mb-1">
                                            <div className={`w-2 h-2 rounded-full ${item.type === 'food' ? 'bg-orange-400' : 'bg-blue-400'}`} />
                                            <span className="text-sm font-black text-gray-600 tracking-tight">
                                                {item.time} {item.endTime ? `- ${item.endTime}` : ''}
                                            </span>
                                        </div>
                                        {/* äº¤é€šæ–¹å¼æ¨™ç±¤ */}
                                        {item.type === 'transport' && item.transportMode && (
                                            <span className="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full font-bold self-start">
                                                {item.transportMode === 'é£›æ©Ÿ' ? 'âœˆï¸ é£›æ©Ÿ' : 
                                                 item.transportMode === 'JR' ? 'ğŸšƒ JR' : 
                                                 item.transportMode === 'åœ°éµ' ? 'ğŸš‡ åœ°éµ' : 
                                                 item.transportMode === 'å…¬è»Š' || item.transportMode === 'å®¢é‹' ? 'ğŸšŒ å·´å£«' : item.transportMode}
                                            </span>
                                        )}
                                    </div>
                                    <div className="flex items-center gap-2">
                                        {editMode && <Icon name="grip-vertical" size={16} className="text-gray-300" />}
                                        <Icon name={item.type === 'food' ? 'utensils' : item.type === 'transport' ? 'train' : 'map-pin'} size={18} className="text-gray-400" />
                                    </div>
                                </div>
                                
                                <h3 className="font-bold text-gray-800 text-lg mb-2 leading-snug">{item.title}</h3>
                                
                                <div onClick={(e) => { e.stopPropagation(); handleGoogleMap(item.location); }} className="text-xs font-bold text-[#556b2f] mb-3 flex items-center gap-1 cursor-pointer hover:underline">
                                    <Icon name="map-pin" size={12} /> {item.location}
                                </div>
                                
                                {item.guide && (
                                    <div className="bg-[#fdf9f0] p-3 rounded-2xl border border-[#fef3c7] mb-3">
                                        <p className="text-xs text-[#b45309] leading-relaxed italic whitespace-pre-wrap flex gap-2">
                                            <Icon name="message-circle" size={14} className="flex-shrink-0 mt-0.5" />
                                            <span>{item.guide}</span>
                                        </p>
                                    </div>
                                )}

                                {item.expenses && item.expenses.length > 0 && (
                                    <div className="mt-2 pt-3 border-t border-dashed border-gray-200 flex flex-wrap gap-2">
                                        {item.expenses.map(e => (
                                            <div key={e.id} className="bg-gray-100 px-3 py-1 rounded-full flex gap-2 items-center">
                                                <span className="text-[10px] text-gray-600 font-medium">{e.name}</span>
                                                <span className="text-[10px] font-bold text-gray-800">Â¥{e.amount}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {editMode && (
                                    <div className="absolute inset-0 bg-[#556b2f]/5 rounded-[28px] border-2 border-dashed border-[#556b2f]/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                        <Icon name="edit" className="text-[#556b2f]" size={32} />
                                    </div>
                                )}
                            </div>
                        ))}
                        
                        {editMode && (
                            <button onClick={() => handleAddItem(activeDay)} className="w-full py-4 border-2 border-dashed border-gray-300 rounded-2xl text-gray-400 hover:border-orange-400 hover:text-orange-500 hover:bg-orange-50 flex items-center justify-center gap-2">
                                <Icon name="plus" size={20} /> <span className="font-medium">æ–°å¢æ­¤æ—¥è¡Œç¨‹</span>
                            </button>
                        )}
                    </main>

                    {/* AI å°éŠæŒ‰éˆ• (Floating Action Button) */}
                    <button 
                        onClick={() => setIsChatOpen(true)}
                        className="fixed bottom-24 right-5 z-40 bg-gradient-to-r from-[#556b2f] to-[#6b8c3e] text-white p-4 rounded-full shadow-2xl shadow-[#556b2f]/40 flex items-center gap-2 animate-bounce hover:scale-105 transition-transform"
                    >
                        <Icon name="sparkles" size={24} className="text-yellow-300" />
                        <span className="font-bold text-sm hidden sm:inline">AI å°éŠ</span>
                    </button>

                    {/* AI èŠå¤©å®¤ */}
                    <AIChatWidget 
                        isOpen={isChatOpen} 
                        onClose={() => setIsChatOpen(false)} 
                        currentDayData={currentDayData}
                    />

                    {/* ç·¨è¼¯é¢æ¿ */}
                    {editingItem && (
                        <div className="fixed inset-0 bg-black/60 z-[100] flex items-end animate-fade-in" onClick={() => setEditingItem(null)}>
                            <div className="bg-white w-full rounded-t-[40px] p-8 space-y-6 pb-12 shadow-2xl h-[85vh] overflow-y-auto overscroll-contain" onClick={e => e.stopPropagation()}>
                                <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-2" />
                                <div className="flex justify-between items-center">
                                    <h3 className="font-black text-xl text-gray-800">ç·¨è¼¯è¡Œç¨‹</h3>
                                    <div className="flex gap-2">
                                        <button onClick={() => handleDeleteItem(editingItem.dayId, editingItem.id)} className="p-2 bg-red-50 text-red-500 rounded-full"><Icon name="trash-2" size={20}/></button>
                                        <button onClick={() => setEditingItem(null)} className="p-2 bg-gray-100 rounded-full"><Icon name="x" size={20}/></button>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="text-[10px] font-bold text-gray-500 uppercase">é–‹å§‹æ™‚é–“</label>
                                        <input type="time" className="w-full bg-gray-50 p-4 rounded-2xl border-none font-bold text-gray-800" value={editingItem.time} onChange={e => setEditingItem({...editingItem, time: e.target.value})} />
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-bold text-gray-500 uppercase">æŠµé”æ™‚é–“</label>
                                        <input type="time" className="w-full bg-gray-50 p-4 rounded-2xl border-none font-bold text-gray-800" value={editingItem.endTime} onChange={e => setEditingItem({...editingItem, endTime: e.target.value})} />
                                    </div>
                                </div>

                                <div>
                                    <label className="text-[10px] font-bold text-gray-500 uppercase">é¡åˆ¥</label>
                                    <div className="flex gap-2 mt-1">
                                        {['sight','food','transport','hotel'].map(t => (
                                            <button key={t} onClick={() => setEditingItem({...editingItem, type: t})} className={`flex-1 py-3 rounded-xl transition-all ${editingItem.type === t ? 'bg-[#556b2f] text-white shadow-md' : 'bg-gray-100 text-gray-400'}`}>
                                                <Icon name={t==='food'?'utensils':t==='transport'?'train':t==='hotel'?'home':'map-pin'} size={18} className="mx-auto"/>
                                            </button>
                                        ))}
                                    </div>
                                    {editingItem.type === 'transport' && (
                                        <div className="mt-3">
                                            <label className="text-[10px] font-bold text-gray-500 uppercase">äº¤é€šå·¥å…·</label>
                                            <div className="flex gap-2 mt-1 overflow-x-auto pb-1 no-scrollbar">
                                                {['é£›æ©Ÿ', 'JR', 'åœ°éµ', 'å…¬è»Š', 'å®¢é‹', 'èµ°è·¯'].map(m => (
                                                    <button key={m} onClick={() => setEditingItem({...editingItem, transportMode: m})} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap ${editingItem.transportMode === m ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-500'}`}>
                                                        {m}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="space-y-4">
                                    <input className="w-full bg-gray-50 p-4 rounded-2xl border-none focus:ring-2 focus:ring-[#556b2f] font-bold text-lg text-gray-800" value={editingItem.title} onChange={e => setEditingItem({...editingItem, title: e.target.value})} placeholder="è¡Œç¨‹æ¨™é¡Œ" />
                                    <input className="w-full bg-gray-50 p-4 rounded-2xl border-none focus:ring-2 focus:ring-[#556b2f] text-sm text-gray-800" value={editingItem.location} onChange={e => setEditingItem({...editingItem, location: e.target.value})} placeholder="åœ°é» (Google Maps é—œéµå­—)" />
                                    <textarea className="w-full bg-gray-50 p-4 rounded-2xl border-none focus:ring-2 focus:ring-[#556b2f] text-sm h-32 text-gray-700 leading-relaxed" value={editingItem.guide} onChange={e => setEditingItem({...editingItem, guide: e.target.value})} placeholder="å°éŠå°å®åš€ (å¯è¼¸å…¥ä¼´æ‰‹ç¦®æ¨è–¦...)" />
                                </div>

                                <div className="space-y-3">
                                    <div className="flex justify-between items-center px-1">
                                        <label className="text-xs font-black text-gray-500 uppercase tracking-widest">è¨˜å¸³é …ç›®</label>
                                        <button onClick={() => setEditingItem({...editingItem, expenses: [...(editingItem.expenses || []), {id: Date.now(), name: '', amount: ''}]})} className="text-xs font-bold text-[#cd853f] bg-orange-50 px-3 py-1 rounded-full">+ æ–°å¢èŠ±è²»</button>
                                    </div>
                                    <div className="space-y-2 pr-2">
                                        {(editingItem.expenses || []).map(exp => (
                                            <div key={exp.id} className="flex gap-2 relative group">
                                                <input className="flex-[2] bg-gray-50 p-3 rounded-xl text-xs text-gray-700 font-bold" value={exp.name} onChange={e => {
                                                    const newExps = editingItem.expenses.map(ex => ex.id === exp.id ? {...ex, name: e.target.value} : ex);
                                                    setEditingItem({...editingItem, expenses: newExps});
                                                }} placeholder="å¦‚ï¼šåˆé¤" />
                                                <input className="flex-1 min-w-[80px] bg-gray-50 p-3 rounded-xl text-xs font-bold text-gray-700" type="number" inputMode="decimal" value={exp.amount} onChange={e => {
                                                    const newExps = editingItem.expenses.map(ex => ex.id === exp.id ? {...ex, amount: e.target.value} : ex);
                                                    setEditingItem({...editingItem, expenses: newExps});
                                                }} placeholder="Â¥" />
                                                <button onClick={() => {
                                                     const newExps = editingItem.expenses.filter(ex => ex.id !== exp.id);
                                                     setEditingItem({...editingItem, expenses: newExps});
                                                }} className="text-red-300 px-2 py-2"><Icon name="x" size={16}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={() => handleUpdateItem(editingItem.dayId, editingItem)} className="w-full py-5 bg-[#556b2f] text-white font-black rounded-3xl shadow-xl shadow-[#556b2f]/20 transform active:scale-95 transition-all">
                                    å„²å­˜æ›´æ–°
                                </button>
                                <div className="h-10"></div>
                            </div>
                        </div>
                    )}

                    {/* Footer ç¸½è¨ˆ (é›™å¹£åˆ¥) */}
                    <footer className="fixed bottom-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-xl p-4 pb-8 rounded-t-[32px] shadow-[0_-10px_40px_rgba(0,0,0,0.08)] border-t border-gray-100">
                        <div className="max-w-md mx-auto grid grid-cols-2 gap-4">
                            {/* å·¦å´ï¼šæœ¬æ—¥å°è¨ˆ */}
                            <div className="text-center border-r border-gray-100 pr-2">
                                <p className="text-[10px] font-bold text-gray-400 mb-1">æœ¬æ—¥é ç®— (JPY / TWD)</p>
                                <div className="flex flex-col items-center">
                                    <span className="text-sm font-black text-gray-700">Â¥{expenses.dayTotalJPY.toLocaleString()}</span>
                                    <span className="text-xs font-bold text-gray-400">â‰ˆ NT${expenses.dayTotalTWD.toLocaleString()}</span>
                                </div>
                            </div>
                            
                            {/* å³å´ï¼šæ—…ç¨‹ç¸½è¨ˆ */}
                            <div className="text-center pl-2">
                                <p className="text-[10px] font-bold text-gray-400 mb-1">æ—…ç¨‹ç¸½è¨ˆ (JPY / TWD)</p>
                                <div className="flex flex-col items-center">
                                    <span className="text-sm font-black text-[#556b2f]">Â¥{expenses.grandTotalJPY.toLocaleString()}</span>
                                    <span className="text-xs font-bold text-[#8fa06f]">â‰ˆ NT${expenses.grandTotalTWD.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
</script>

<!-- PWA Service Worker è¨»å†Š -->
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registered"))
        .catch(err => console.log("SW registration failed:", err));
    });
  }
  </script>
</body>

</html>





